generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// ENUMS
// ============================================================================

enum Role {
  EMPLOYEE
  HR
  ADMIN
}

enum ComponentType {
  BASIC
  HRA
  STANDARD_ALLOWANCE
  BONUS
  LTA
  FIXED_ALLOWANCE
}

enum ValueType {
  FIXED
  PERCENTAGE
}

// ============================================================================
// CORE USER MODELS
// ============================================================================

model GlobalSerial {
  id         Int @id @default(1)
  lastSerial Int
}

model User {
  id         String @id @default(uuid())
  employeeId String @unique
  email      String @unique
  password   String
  role       Role   @default(EMPLOYEE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile EmployeeProfile?
}

model EmployeeProfile {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  name             String
  photo            String?
  department       String?
  phone            String?
  dob              DateTime?
  address          String?
  emergencyContact String?
  managerId        String?
  manager          EmployeeProfile?  @relation("ManagerToEmployee", fields: [managerId], references: [id])
  directReports    EmployeeProfile[] @relation("ManagerToEmployee")
  designationId    String
  designation      Designation       @relation(fields: [designationId], references: [id])

  joinedAt DateTime

  salary      EmployeeSalary?
  bankDetails EmployeeBankDetails?
}

// ============================================================================
// DESIGNATION & SALARY STRUCTURE (HELPER / TEMPLATE)
// ============================================================================

model Designation {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?

  salaryStructure SalaryStructure?
  employees       EmployeeProfile[]
}

model SalaryStructure {
  id            String      @id @default(uuid())
  designationId String      @unique
  designation   Designation @relation(fields: [designationId], references: [id])

  components SalaryStructureComponent[]
}

model SalaryStructureComponent {
  id                String          @id @default(uuid())
  salaryStructureId String
  salaryStructure   SalaryStructure @relation(fields: [salaryStructureId], references: [id])

  type       ComponentType
  valueType  ValueType
  value      Float // % or fixed value
  orderIndex Int

  @@unique([salaryStructureId, type])
}

// ============================================================================
// EMPLOYEE SALARY (FINAL CALCULATED DATA)
// ============================================================================

model EmployeeSalary {
  id         String          @id @default(uuid())
  employeeId String          @unique
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id])

  monthlyWage Float
  grossSalary Float
  netSalary   Float

  // === Calculated deductions / contributions ===
  pfEmployee      Float
  pfEmployer      Float
  professionalTax Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  components EmployeeSalaryComponent[]
}

model EmployeeSalaryComponent {
  id               String         @id @default(uuid())
  employeeSalaryId String
  employeeSalary   EmployeeSalary @relation(fields: [employeeSalaryId], references: [id], onDelete: Cascade)

  type   ComponentType
  amount Float

  @@unique([employeeSalaryId, type])
}

model EmployeeBankDetails {
  id                String          @id @default(uuid())
  employeeProfileId String          @unique
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  accountNumber String
  bankName      String
  ifscCode      String

  panNumber    String?
  uanNumber    String?

  verified Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
